<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.network.mylittletale.tale.model.dao.TaleMapper">
    <resultMap id="cutData" type="com.network.mylittletale.tale.model.dto.CutDataDTO">
        <id property="cutNo" column="CUT_NO"/>
        <result property="inputSentence" column="INPUT_SENTENCE"/>
        <result property="taleNo" column="TALE_NO"/>
        <result property="cutSequence" column="CUT_SEQUENCE"/>
        <result property="imgName" column="IMG_NAME"/>
        <result property="memberYN" column="MEMBER_YN"/>
    </resultMap>

    <select id="getCutNo" resultType="int">
        SELECT
               SEQ_CUT_NO.NEXTVAL
          FROM DUAL
    </select>

    <select id="getTaleSequence" resultType="int">
        SELECT
               SEQ_TALE_NO.NEXTVAL
        FROM DUAL
    </select>

    <insert id="insertCutData" parameterType="com.network.mylittletale.tale.model.dto.CutDataDTO">
        INSERT INTO TBL_CUT_DATA A
        (
          A.CUT_NO
        , A.INPUT_SENTENCE
        , A.TALE_NO
        , A.CUT_SEQUENCE
        , A.IMG_NAME
        , A.MEMBER_YN
        )
        VALUES
        (
          #{cutNo}
        , #{inputSentence}
        , #{taleNo}
        , #{cutSequence}
        , #{imgName}
        , #{memberYN}
        )
    </insert>

    <select id="getCutSequence" resultType="int">
        SELECT MAX(CUT_SEQUENCE) FROM TBL_CUT_DATA WHERE TALE_NO = ${taleNo}
    </select>
    <select id="getTales" resultMap="cutData">
        SELECT
               INPUT_SENTENCE
             , TALE_NO
             , IMG_NAME
             , CUT_SEQUENCE
          FROM TBL_CUT_DATA
         WHERE TALE_NO = #{taleNo}
         ORDER BY CUT_SEQUENCE
    </select>

    <update id="updateTaleNo">
        UPDATE TBL_CUT_DATA
           SET TALE_NO = #{taleNo}
         WHERE CUT_NO = #{sequence}
    </update>

    <insert id="insertTale">
        INSERT INTO TBL_CREATED_TALE
        (
          TALE_NO
        , CREATED_DATE
        , IS_DELETE
        , CHILD_NO
        )
        VALUES
        (
          ${taleNo}
        , SYSDATE
        , 'N'
        , ${childNo}
        )
    </insert>

    <select id="getTaleList" resultType="int">
        SELECT
               TALE_NO
          FROM TBL_CREATED_TALE
         WHERE CHILD_NO = #{childNo}
    </select>

</mapper>
